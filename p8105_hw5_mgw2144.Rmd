---
title: "p8105_hw5_mgw2144"
output: github_document
date: "2023-11-08"
---

```{r message=FALSE}
library(tidyverse)
library(rvest)

knitr::opts_chunk$set(
  fig.width = 8,
  fig.height = 6,
  out.width = "90%"
)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = ("viridis"))

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1 


# Problem 2
## Reading the data and creating a dataframe with the map function

```{r message=FALSE, warning=FALSE}
study_data = 
  tibble(
    files = list.files('data/study_data'),
    path = str_c("data/study_data/", files)
  ) %>% 
  mutate(data = map(path, read_csv)) %>% 
  unnest() 
```

## Tidying the data

```{r}

study_data_tidy = 
  study_data %>% 
  separate(files, into = c("control_arm", "subject_ID", "csv")) %>% 
  mutate(
    control_arm = ifelse(control_arm == "con", "control", control_arm),
    control_arm = ifelse(control_arm == "exp", "experimental", control_arm)
  ) %>% 
  pivot_longer(
    cols = starts_with("week"),
    names_prefix = "week_",
    names_to = "week_number",
    values_to = "observation"
  ) %>% 
  mutate(
     week_number = as.numeric(week_number)) %>% 
  select(control_arm, subject_ID, week_number, observation)

```

## Plotting the tidy data 

```{r}

study_plot = 
  study_data_tidy %>% 
  ggplot(aes(x = week_number, y = observation, colour = subject_ID)) +
  geom_point() +
  geom_line() +
  facet_grid(.~control_arm) +
  labs(
    x = "Week",
    y = "Observation", 
    title = "Observations by week for each subject in both control arms" 
  )

study_plot

```

The control arm appears to have observations steadily between the range of approximately -2.3 and 4.3 for all 8 weeks and for all 10 subjects with the lowest observation value seen in week 6 for subject 5 and the highest observation value seen in week 5 for subject 10. The experimental arm shows a steady positive/increasing trend for the observations values in all subjects across the 8 week period. The lowest observation value for the experimental arm was in subject 1 in week 1, and the highest observational value was in week 9 for subject 5. This indicates a positive relationship between observation value and week (time) in the experimental arm that we do not see in the control arm. 

# Problem 3 

## Creating function and map
```{r}
sim_function = function(n = 30, mu_val = c(0, 1, 2, 3, 4, 5, 6), sigma = 5, alpha = 0.05, num_datasets = 5000) {
  
  datasets = replicate(num_datasets, rnorm(n, mean = 0, sd = sigma), simplify = FALSE)
  
  results = map_df(mu_val, function(mu) {
    map_df(datasets, function(dataset) {
      t_test_result = t.test(dataset, mu = mu)
      tidy_results = broom::tidy(t_test_result)
      data.frame(mu = mu, mu_est = tidy_results$estimate, p_value = tidy_results$p.value)
    })
  })
  
  return(results)
}

result_df = sim_function()

```

## Plot 1: Power vs. True Mean 

```{r}
plot_1_df =
  result_df %>%
  group_by(mu) %>%
  summarise(power = mean(p_value < 0.05))

plot_1=
ggplot(plot_1_df, aes(x = mu, y = power)) +
  geom_line() +
  geom_point() +
  labs(
    x = "True mu value",
    y = "Power of the Test",
    title = "Association between effect size and power"
  )

plot_1
```


The graph of the association between effect size and power shows us that as the true mean or mu value increases, power also increases. There appears to be a strong positive association between effect size and power.


## Plot 2: Average estimate of mu hat compared to true mu value 

```{r}
plot_2_df =
result_df %>%
  group_by(mu) %>%
  summarise(avg_mu_hat = mean(mu_est))
  
plot_2 = 
  plot_2_df %>% 
  ggplot(aes(x = mu, y = avg_mu_hat)) +
  geom_point()+
  geom_smooth()+
  labs(
    title = "Average estiamte of mu hat vs. the true mu value",
    x = "True mu value",
    y = "Estimated mu value"
  )

plot_2

```

